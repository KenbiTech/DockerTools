name: Test Console app
on: 
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

env:
  AWS_REGION: eu-central-1
jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    defaults:
      run:
        shell: bash
    steps:
      - name: Check Docker
        run: |
          docker ps
      
      - uses: actions/checkout@v4
      
      - name: AWS Code Artifact
        uses: KenbiTech/github-actions-code-artifact@v3
        with:
          aws-region: ${{ env.AWS_REGION }}
          aws-role: ${{ vars.AWS_TOOLING_CODEARTIFACT_ROLE }}
      
      - name: Build
        run: |
          dotnet restore
          dotnet build --configuration Release
      - name: Run console
        run: |
          cd DockerTools.ConsoleApp/DockerTools.ConsoleApp
          ls -l ./bin/Release/net6.0
          dotnet run --no-build --configuration Release
      
